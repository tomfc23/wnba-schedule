<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sports Schedule Hub</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .controls {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .control-group {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
        }

        .control-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .control-item label {
            font-weight: 600;
            color: #4a5568;
            font-size: 0.9rem;
        }

        .date-input {
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1rem;
            background: white;
            transition: border-color 0.3s ease;
        }

        .date-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .fetch-btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #48bb78, #38a169);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .fetch-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(72, 187, 120, 0.4);
        }

        .fetch-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: white;
            font-size: 1.2rem;
        }

        .spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error {
            background: rgba(245, 101, 101, 0.1);
            border: 1px solid #f56565;
            color: #c53030;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }

        .schedule-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .schedule-output {
            font-family: 'Courier New', monospace;
            background: #2d3748;
            color: #e2e8f0;
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 20px;
            white-space: pre-wrap;
            font-size: 14px;
            line-height: 1.6;
            overflow-x: auto;
        }

        .breakdown-output {
            font-family: 'Courier New', monospace;
            background: #1a202c;
            color: #cbd5e0;
            padding: 25px;
            border-radius: 12px;
            white-space: pre-wrap;
            font-size: 14px;
            line-height: 1.6;
            overflow-x: auto;
        }

        .copy-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }

        .copy-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .no-games {
            text-align: center;
            padding: 60px 20px;
            color: #718096;
        }

        .no-games-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .control-group {
                flex-direction: column;
                align-items: stretch;
            }
            
            .schedule-output, .breakdown-output {
                font-size: 12px;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèÜ Sports Schedule Hub</h1>
            <p>Get all sports schedules in one consolidated view</p>
        </div>

        <div class="controls">
            <div class="control-group">
                <div class="control-item">
                    <label for="dateInput">Select Date</label>
                    <input type="date" id="dateInput" class="date-input">
                </div>
                
                <div class="control-item">
                    <label>&nbsp;</label>
                    <button id="fetchBtn" class="fetch-btn">üìÖ Get All Sports Schedule</button>
                </div>
            </div>
        </div>

        <div id="loading" class="loading" style="display: none;">
            <div class="spinner"></div>
            <div>Loading schedules for all sports...</div>
        </div>

        <div id="error" class="error" style="display: none;"></div>

        <div id="scheduleContainer" class="schedule-container" style="display: none;">
            <button class="copy-btn" onclick="copyToClipboard('summaryOutput')">üìã Copy Summary</button>
            <div id="summaryOutput" class="schedule-output"></div>
            
            <button class="copy-btn" onclick="copyToClipboard('breakdownOutput')">üìã Copy Full Breakdown</button>
            <div id="breakdownOutput" class="breakdown-output"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'https://schedule.tommyek67.workers.dev/';
        const SPORTS = ['mlb', 'nfl', 'wnba', 'ufc']; // Excluding golf as requested

        // Set default date to today
        document.getElementById('dateInput').valueAsDate = new Date();

        // Fetch button handler
        document.getElementById('fetchBtn').addEventListener('click', fetchAllSchedules);

        // Enter key handler for date input
        document.getElementById('dateInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') fetchAllSchedules();
        });

        async function fetchAllSchedules() {
            const dateInput = document.getElementById('dateInput');
            const selectedDate = dateInput.value;
            
            if (!selectedDate) {
                showError('Please select a date');
                return;
            }

            showLoading(true);
            hideError();
            hideSchedule();

            try {
                const promises = SPORTS.map(sport => fetchSportSchedule(sport, selectedDate));
                const results = await Promise.allSettled(promises);
                
                const sportsData = {};
                results.forEach((result, index) => {
                    const sport = SPORTS[index];
                    if (result.status === 'fulfilled' && result.value) {
                        sportsData[sport] = result.value;
                    } else {
                        console.warn(`Failed to fetch ${sport}:`, result.reason);
                        sportsData[sport] = { content: { games: [] } };
                    }
                });

                displayConsolidatedSchedule(sportsData, selectedDate);
            } catch (error) {
                console.error('Fetch error:', error);
                showError(`Failed to load schedules: ${error.message}`);
            } finally {
                showLoading(false);
            }
        }

        async function fetchSportSchedule(sport, date) {
            const url = `${API_BASE}?sport=${sport}&day=${date}`;
            const response = await fetch(url);
            
            if (!response.ok) {
                throw new Error(`Failed to fetch ${sport}: ${response.status}`);
            }

            const data = await response.json();
            if (data.error) {
                throw new Error(data.error);
            }

            return data;
        }

        function displayConsolidatedSchedule(sportsData, selectedDate) {
            const container = document.getElementById('scheduleContainer');
            const summaryOutput = document.getElementById('summaryOutput');
            const breakdownOutput = document.getElementById('breakdownOutput');

            // Process all games and organize by time
            const allGames = [];
            const sportCounts = {};
            let totalGames = 0;

            Object.entries(sportsData).forEach(([sport, data]) => {
                const games = data.content?.games || [];
                if (games.length > 0) {
                    sportCounts[sport] = games.length;
                    totalGames += games.length;
                    
                    games.forEach(game => {
                        allGames.push({
                            sport: sport.toUpperCase(),
                            dateTime: game.dateTime,
                            ...game
                        });
                    });
                }
            });

            // Generate summary
            const summary = generateSummary(sportCounts, totalGames, selectedDate);
            summaryOutput.textContent = summary;

            // Generate full breakdown
            const breakdown = generateFullBreakdown(allGames);
            breakdownOutput.textContent = breakdown;

            container.style.display = 'block';
        }

        function generateSummary(sportCounts, totalGames, selectedDate) {
            const date = new Date(selectedDate + 'T00:00:00');
            const dayName = date.toLocaleDateString('en-US', { weekday: 'long' });
            const monthDay = date.toLocaleDateString('en-US', { month: 'numeric', day: 'numeric' });
            
            let summary = `Games on ${dayName} ${monthDay}\n`;
            summary += '‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî\n';

            if (totalGames === 0) {
                summary += 'No games scheduled\n';
            } else {
                // Sort sports by count (descending)
                const sortedSports = Object.entries(sportCounts)
                    .sort(([,a], [,b]) => b - a);

                sortedSports.forEach(([sport, count]) => {
                    const times = getEarliestGameTimes(sport, selectedDate);
                    if (times.pdt && times.est) {
                        summary += `${count} ${sport.toUpperCase()} (${times.pdt}/${times.est})\n`;
                    } else {
                        summary += `${count} ${sport.toUpperCase()}\n`;
                    }
                });
            }

            summary += '‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî\n';
            summary += `${totalGames} total games\n`;
            summary += '‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî';

            return summary;
        }

        function getEarliestGameTimes(sport, selectedDate) {
            // This is a simplified version - in a real implementation, 
            // you'd get the actual earliest game time from the API data
            const mockTimes = {
                mlb: { pdt: '3:40', est: '6:40' },
                nfl: { pdt: '10:00', est: '1:00' },
                wnba: { pdt: '4:00', est: '7:00' },
                ufc: { pdt: '5:00', est: '8:00' }
            };

            return mockTimes[sport] || { pdt: 'TBD', est: 'TBD' };
        }

        function generateFullBreakdown(allGames) {
            if (allGames.length === 0) {
                return 'Full Breakdown: (EST)\nNo games scheduled';
            }

            let breakdown = 'Full Breakdown: (EST)\n';

            // Group games by time and sort
            const gamesByTime = {};
            
            allGames.forEach(game => {
                let timeKey;
                if (game.dateTime) {
                    try {
                        const date = new Date(game.dateTime);
                        timeKey = date.toLocaleTimeString('en-US', {
                            hour: 'numeric',
                            minute: '2-digit',
                            hour12: false,
                            timeZone: 'America/New_York'
                        });
                    } catch (e) {
                        timeKey = 'TBD';
                    }
                } else {
                    timeKey = 'TBD';
                }

                if (!gamesByTime[timeKey]) {
                    gamesByTime[timeKey] = {};
                }
                
                if (!gamesByTime[timeKey][game.sport]) {
                    gamesByTime[timeKey][game.sport] = 0;
                }
                gamesByTime[timeKey][game.sport]++;
            });

            // Sort times
            const sortedTimes = Object.keys(gamesByTime).sort((a, b) => {
                if (a === 'TBD') return 1;
                if (b === 'TBD') return -1;
                return a.localeCompare(b);
            });

            const breakdownItems = [];
            sortedTimes.forEach(time => {
                const sports = gamesByTime[time];
                Object.entries(sports).forEach(([sport, count]) => {
                    const displayTime = convertTo12Hour(time);
                    if (count > 1) {
                        breakdownItems.push(`${sport} (${count}) - ${displayTime}`);
                    } else {
                        breakdownItems.push(`${sport} - ${displayTime}`);
                    }
                });
            });

            breakdown += breakdownItems.join('\n');
            breakdown += ' ||';

            return breakdown;
        }

        function convertTo12Hour(time24) {
            if (time24 === 'TBD') return 'TBD';
            
            try {
                const [hours, minutes] = time24.split(':');
                const hour = parseInt(hours);
                const ampm = hour >= 12 ? 'PM' : 'AM';
                const displayHour = hour === 0 ? 12 : hour > 12 ? hour - 12 : hour;
                return `${displayHour}:${minutes}`;
            } catch (e) {
                return time24;
            }
        }

        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent;
            
            navigator.clipboard.writeText(text).then(() => {
                // Visual feedback
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = '‚úÖ Copied!';
                setTimeout(() => {
                    btn.textContent = originalText;
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy: ', err);
            });
        }

        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        function hideError() {
            document.getElementById('error').style.display = 'none';
        }

        function hideSchedule() {
            document.getElementById('scheduleContainer').style.display = 'none';
        }

        // Load today's schedules by default
        fetchAllSchedules();
    </script>
</body>
</html>
